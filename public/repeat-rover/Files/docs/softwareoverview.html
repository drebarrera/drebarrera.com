<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">ol{margin:0;padding:0}table td,table th{padding:0}.c19{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#ffffff;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#ffffff;border-left-width:1.5pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:339pt;border-top-color:#ffffff;border-bottom-style:solid}.c12{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#ffffff;border-top-width:1pt;border-right-width:1.5pt;border-left-color:#ffffff;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:129pt;border-top-color:#ffffff;border-bottom-style:solid}.c1{margin-left:72pt;padding-top:0pt;text-indent:36pt;padding-bottom:0pt;line-height:1.1500000000000001;orphans:2;widows:2;text-align:left}.c18{-webkit-text-decoration-skip:none;color:#0000ff;font-weight:400;text-decoration:underline;vertical-align:baseline;text-decoration-skip-ink:none;font-family:"Times New Roman";font-style:normal}.c15{color:#000000;font-weight:700;text-decoration:none;vertical-align:baseline;font-size:14pt;font-family:"Times New Roman";font-style:normal}.c0{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:12pt;font-family:"Times New Roman";font-style:normal}.c4{color:#000000;font-weight:700;text-decoration:none;vertical-align:baseline;font-size:12pt;font-family:"Times New Roman";font-style:normal}.c7{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:9pt;font-family:"Times New Roman";font-style:normal}.c13{color:#ff0000;font-weight:400;text-decoration:none;vertical-align:baseline;font-family:"Times New Roman";font-style:italic}.c26{padding-top:0pt;padding-bottom:0pt;line-height:1.1500000000000001;orphans:2;widows:2;text-align:center}.c14{padding-top:0pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:center}.c2{padding-top:0pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c6{padding-top:0pt;padding-bottom:0pt;line-height:1.1500000000000001;orphans:2;widows:2;text-align:left}.c16{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-family:"Times New Roman";font-style:italic}.c22{padding-top:0pt;padding-bottom:0pt;line-height:1.0;text-align:left}.c9{margin-left:5pt;border-spacing:0;border-collapse:collapse;margin-right:auto}.c21{text-decoration-skip-ink:none;-webkit-text-decoration-skip:none;color:#1155cc;text-decoration:underline}.c25{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c17{font-style:italic;font-weight:400}.c11{color:inherit;text-decoration:inherit}.c8{vertical-align:sub}.c24{font-weight:400}.c5{font-size:12pt}.c3{height:12pt}.c23{text-indent:36pt}.c20{font-weight:700}.c10{height:0pt}.c28{margin-left:72pt}.c27{font-size:9pt}.title{padding-top:0pt;color:#000000;font-weight:700;font-size:14pt;padding-bottom:0pt;font-family:"Times New Roman";line-height:1.0;orphans:2;widows:2;text-align:center}.subtitle{padding-top:18pt;color:#666666;font-size:24pt;padding-bottom:4pt;font-family:"Georgia";line-height:1.0;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:12pt;font-family:"Times New Roman"}p{margin:0;color:#000000;font-size:12pt;font-family:"Times New Roman"}h1{padding-top:0pt;color:#000000;font-size:12pt;padding-bottom:0pt;font-family:"Times New Roman";line-height:1.0;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-weight:700;font-size:18pt;padding-bottom:4pt;font-family:"Times New Roman";line-height:1.0;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:14pt;color:#000000;font-weight:700;font-size:14pt;padding-bottom:4pt;font-family:"Times New Roman";line-height:1.0;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:12pt;color:#000000;font-weight:700;font-size:12pt;padding-bottom:2pt;font-family:"Times New Roman";line-height:1.0;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:11pt;color:#000000;font-weight:700;font-size:11pt;padding-bottom:2pt;font-family:"Times New Roman";line-height:1.0;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:10pt;color:#000000;font-weight:700;font-size:10pt;padding-bottom:2pt;font-family:"Times New Roman";line-height:1.0;page-break-after:avoid;orphans:2;widows:2;text-align:left}</style></head><body class="c25 doc-content"><div><p class="c2" id="h.gjdgxs"><span class="c0">ECE 477: Digital Systems Senior Design&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c16 c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c0">Last Modified: </span><span>09-10-22</span></p></div><p class="c14 title"><span class="c15">Software Overview</span></p><p class="c14 c3 title"><span class="c15"></span></p><p class="c2 title"><span class="c4">Year: 2022&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Semester: Fall&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Team: 16 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Project: Repeat Rover</span></p><p class="c2 title"><span class="c4">Creation Date: 09-07-2022&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Last Modified: 09-10-2022</span></p><p class="c2 title"><span class="c4">Author: &nbsp;Andres Barrera&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Email: barrer10@purdue.edu</span></p><p class="c2 c3 title"><span class="c4"></span></p><p class="c2 title"><span class="c5">1.0 Software Overview</span></p><p class="c2 c23 title"><span class="c0">Repeat Rover is a remote-programmable R/C vehicle designed for resource delivery in repeated process environments such as manufacturing plants and product storage warehouses. As such, firmware has a critical role, reading data from peripherals and performing calculations to determine vehicle metrics. More specifically, the Repeat Rover firmware determines vehicle speed and distance traversed from the wheel speed sensors, vehicle bearing from the magnetometer, stores and retrieves data in a SD card, sends direction and speed information to the motor controller, and wirelessly receives vehicle instructions from bluetooth.</span></p><p class="c2 c3"><span class="c0"></span></p><p class="c2"><span class="c4">1.1 Basic Function</span></p><p class="c2"><span class="c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;With simple manual instruction via the bluetooth-communicated commands, the Repeat Rover will store direction and distance data in a file within a SD card while driving the motors. Once programming is complete and a bluetooth &ldquo;DONE&rdquo; command has been sent, the Repeat Rover will retrace its path back to origin. When prompted with a &ldquo;REPEAT_PATH&rdquo; bluetooth command, the Repeat Rover will repeat the directions stored in the SD card by traversing the path, and then inverse the path, to retrace its steps and return to origin. </span></p><p class="c2 c3"><span class="c0"></span></p><p class="c2"><span class="c4">1.2 Wheel Speed Sensor</span></p><p class="c2 c23"><span>The wheel speed sensor sends a digital pulse through an amplifying and noise-filtering interfacing circuit to the main nRF52832 controller. This pulse is read as a logic high when it exceeds the voltage threshold of Voltage Input High, V</span><span class="c8">IH</span><span>&nbsp;= 0.7 V</span><span class="c8">DD</span><span>, and a logic low when it is under the voltage threshold of Voltage Input Low, V</span><span class="c8">IL</span><span>&nbsp;= 0.3 V</span><span class="c8">DD</span><span class="c0">. Determining the time between the start of each logic high pulse gives the period of the signal (time will be tracked by leveraging the nRF52832&rsquo;s built-in clock) - the inverse of which is the signal frequency. Wheel speed and distance traversed will be used to verify that the Repeat Rover has fulfilled a movement command. When repeating a path, the wheel speed and distance traversed will be used to track the progress of the vehicle and detect autonomous error. Autonomous error includes obstacle interference and slippage. There will be four wheel speed sensors, two monitoring each of the driven rear wheels and two monitoring each of the undriven front wheels. By comparing the movement of the undriven wheels to that of the driven wheels, slippage and obstacle interference may be detected.</span></p><p class="c2 c3"><span class="c0"></span></p><p class="c2"><span class="c4">1.3 Magnetometer</span></p><p class="c2"><span class="c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The magnetometer sends digital rotation information with I2C protocol to the main nRF52832 controller. The information received from the magnetometer will be used to determine the bearing of the vehicle. The bearing at a given point in the vehicle&rsquo;s path will be compared to the bearing at startup and will determine the path recorded by the controller. The vehicle&rsquo;s bearing will be used to verify that the Repeat Rover has fulfilled a movement command. When repeating a path, the bearing will be used to track the progress of a vehicle and detect autonomous error.</span></p><p class="c2 c3"><span class="c4"></span></p><p class="c2"><span class="c4">1.4 Motor Control</span></p><p class="c2"><span class="c20">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c0">When under programming, the Repeat Rover will accept commands from a bluetooth transceiver and translate the commands to motor control signals. The motor controller will accept a PWM signal with the frequency of the digital pulse signal relating directly to the speed of the controller. In addition to this, the motor controller will accept a signal to determine the direction of the motor spin. When under path recall, the Repeat Rover will receive commands from an SD card and interpret them accordingly.</span></p><p class="c2"><span class="c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If the Repeat Rover reads a forward (FWD) movement, both motors will be used to move in a forward direction (Left: CCW; Right: CW). If the Repeat Rover reads a reverse (REV) movement, both motors will be used to move in a backwards direction (Left: CW; Right CCW). When turning CW, the Repeat Rover will leave the right motor fixed, while rotating the left motor. Inversely, when turning CCW, the Repeat Rover will leave the left motor fixed, while rotating the right motor.</span></p><p class="c2 c3"><span class="c4"></span></p><p class="c2"><span class="c4">1.5 Wireless Bluetooth Communication and Program Flow</span></p><p class="c2"><span class="c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A Bluetooth module will exchange commands between the Repeat Rover and an external device. For testing, a smart phone will be used to send commands to the vehicle. For program flow, see Appendix 2: Program Flow.</span></p><p class="c2 c3"><span class="c0"></span></p><p class="c2 c3"><span class="c0"></span></p><p class="c2 title"><span class="c5">2.0 Description of Algorithms</span></p><p class="c2 title"><span class="c5">2.1 Wheel Speed Calculations</span></p><p class="c2"><span class="c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Given the signal frequency and the number of poles within the signal-inducing reluctor, the following equation can be used to calculate wheel speed:</span></p><p class="c6 c28"><span class="c16 c5">Equation 2.1.1:</span></p><p class="c26"><img src="images4/image1.webp"></p><a id="t.2f54744082c2f208114aff3c5afdf4c68927a22b"></a><a id="t.0"></a><table class="c9"><tr class="c10"><td class="c12" colspan="1" rowspan="1"><p class="c22 c3"><span class="c7"></span></p></td><td class="c19" colspan="1" rowspan="1"><p class="c6"><img src="images4/image2.webp"><span class="c7">&nbsp;= revolutions per minute, </span></p><p class="c6"><img src="images4/image3.webp"><span class="c7">&nbsp;= frequency, </span></p><p class="c6"><img src="images4/image4.webp"><span class="c7">&nbsp;= number of reluctor poles, </span></p><p class="c6"><img src="images4/image5.webp"><span class="c27">&nbsp;= time of pulse </span><img src="images4/image6.webp"></p></td></tr></table><p class="c6 c3"><span class="c0"></span></p><p class="c6"><span class="c0">Given the wheel circumference, number of poles within the signal-inducing reluctor, and the number of pulses in a given period of time, the following equation can be used to calculate distance traversed:</span></p><p class="c1"><span class="c5 c16">Equation 2.1.2:</span></p><p class="c26"><img src="images4/image7.webp"></p><a id="t.67370ec467342d727472e4cafb01efbe30383d45"></a><a id="t.1"></a><table class="c9"><tr class="c10"><td class="c12" colspan="1" rowspan="1"><p class="c3 c22"><span class="c7"></span></p></td><td class="c19" colspan="1" rowspan="1"><p class="c6"><img src="images4/image8.webp"><span class="c7">&nbsp;= distance traversed,</span></p><p class="c6"><img src="images4/image9.webp"><span class="c7">&nbsp;= number of pulses, </span></p><p class="c6"><img src="images4/image10.webp"><span class="c7">&nbsp;= wheel circumference, </span></p><p class="c6"><img src="images4/image4.webp"><span class="c7">&nbsp;= number of reluctor poles </span></p></td></tr></table><p class="c6 c3"><span class="c0"></span></p><p class="c2"><span class="c0">The Repeat Rover&rsquo;s main controller will calculate wheel speed synchronously and average values when repeating movements to create smooth motion. It will calculate distance traversed for variant periods of motion in a single direction.</span></p><p class="c2 c3"><span class="c0"></span></p><p class="c2 title"><span class="c4">3.0 Description of Data Structures</span></p><p class="c2 title"><span class="c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The Repeat Rover will use a linked list queues and stacks to store, push, and pull data. In file-format, these commands will be listed in ASCII newline delimited form, each describing a movement of the vehicle. When a file is read, each command will be added to a queue (FIFO) by pushing the command to a linked list. Each new node will point to the previous. When reading the path from the queue, the entire queue will first be traversed to find the last node. This last node will then be pulled, giving the first command. This command will then be pushed to a stack (LIFO) linked list.The stack will be a list of commands for retracing. Once all commands have been used to traverse the vehicle&rsquo;s path and the stack is completely full, the inverse will occur - where all nodes are pulled from the stack and pushed to the queue, inversing the queue. Each pulled stack command will be used to retrace the vehicle&rsquo;s steps by referencing the inverse of the command in a list of command-to-inverse movements and performing the inverse movement. For example, if the command indicates forward movement, backwards movement will be applied to the vehicle. Similarly, if the command indicates a clockwise rotation, a counterclockwise rotation will be performed.</span></p><p class="c2 c3"><span class="c0"></span></p><p class="c2 title" id="h.rztyytghhb1q"><span class="c5">4.0 Relevant Abbreviations:</span></p><p class="c2"><span class="c0">BLE - Bluetooth Low Energy</span></p><p class="c2"><span class="c0">BLE_RX - Bluetooth Low Energy Receiver</span></p><p class="c2"><span class="c0">BLE_TX - Bluetooth Low Energy Transceiver</span></p><p class="c2"><span class="c0">CCW - Counter Clockwise</span></p><p class="c2"><span class="c0">CW - Clockwise</span></p><p class="c2"><span class="c0">CMD - Command</span></p><p class="c2"><span class="c0">EOL - End Of Line</span></p><p class="c2"><span class="c0">ERR - Error</span></p><p class="c2"><span class="c0">FWD - Forward</span></p><p class="c2"><span class="c0">MAG - Magnetometer</span></p><p class="c2"><span class="c0">RCC - Rotate Counter Clockwise</span></p><p class="c2"><span class="c0">RCW - Rotate Clockwise</span></p><p class="c2"><span class="c0">REV - Reverse</span></p><p class="c2"><span class="c0">WSS - Wheel Speed Sensor</span></p><p class="c2 c3"><span class="c0"></span></p><p class="c2 title"><span class="c4">5.0 Sources Cited:</span></p><p class="c2 title"><span class="c5 c24">[1] Nordic Semiconductor </span><span class="c5 c17">nRF52832 Product Specification v.1.8</span><span class="c0">&nbsp;[Online] Available:</span></p><p class="c2"><span class="c21"><a class="c11" href="https://www.google.com/url?q=https://infocenter.nordicsemi.com/pdf/nRF52832_PS_v1.8.pdf&amp;sa=D&amp;source=editors&amp;ust=1679056269025553&amp;usg=AOvVaw1-XBZiyve14XJqnmO-mA-0">https://infocenter.nordicsemi.com/pdf/nRF52832_PS_v1.8.pdf</a></span></p><p class="c2 c3"><span class="c0"></span></p><p class="c2 c3"><span class="c0"></span></p><p class="c2 c3"><span class="c0"></span></p><p class="c2 c3"><span class="c0"></span></p><p class="c2 c3"><span class="c0"></span></p><p class="c2 c3"><span class="c0"></span></p><p class="c14 title"><span class="c5">Appendix 1: Move Flowchart</span></p><p class="c2 title"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 550.67px;"><img alt="" src="images4/image11.webp" style="width: 624.00px; height: 550.67px; margin-left: -0.00px; margin-top: -0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2 c3 title"><span class="c13 c5"></span></p><p class="c2 c3 title"><span class="c13 c5"></span></p><p class="c2 c3 title"><span class="c13 c5"></span></p><p class="c2 c3 title"><span class="c13 c5"></span></p><p class="c2 c3 title"><span class="c13 c5"></span></p><p class="c2 c3 title"><span class="c13 c5"></span></p><p class="c2 c3 title"><span class="c13 c5"></span></p><p class="c2 c3 title"><span class="c13 c5"></span></p><p class="c2 c3 title"><span class="c13 c5"></span></p><p class="c2 c3 title"><span class="c5 c13"></span></p><p class="c2 c3 title"><span class="c4"></span></p><p class="c14 title"><span class="c5">Appendix 2: Program State Diagram</span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 639.04px; height: 804.50px;"><img alt="" src="images4/image12.webp" style="width: 639.04px; height: 805.87px; margin-left: -0.00px; margin-top: -0.68px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><div><p class="c2"><span class="c5 c18"><a class="c11" href="https://www.google.com/url?q=https://engineering.purdue.edu/ece477&amp;sa=D&amp;source=editors&amp;ust=1679056269028606&amp;usg=AOvVaw361bLcG9TJ4AyqBUtZWXxc">https://engineering.purdue.edu/ece477</a></span><span class="c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Page </span><span class="c0">&nbsp;of </span></p><p class="c2 c3"><span class="c0"></span></p></div></body></html>